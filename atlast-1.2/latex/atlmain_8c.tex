\hypertarget{atlmain_8c}{}\section{atlmain.\+c File Reference}
\label{atlmain_8c}\index{atlmain.\+c@{atlmain.\+c}}
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$signal.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include \char`\"{}atldef.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}atlcfig.\+h\char`\"{}}\newline
{\ttfamily \#include $<$inttypes.\+h$>$}\newline
Include dependency graph for atlmain.\+c\+:
% FIG 0
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}{F\+A\+L\+SE}~0
\item 
\#define \hyperlink{atlmain_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{T\+R\+UE}~1
\item 
\#define \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V}~(void)
\item 
\#define \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(x)~(void) fprintf(stderr, x)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{atlmain_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}\label{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}} 
\index{atlmain.\+c@{atlmain.\+c}!F\+A\+L\+SE@{F\+A\+L\+SE}}
\index{F\+A\+L\+SE@{F\+A\+L\+SE}!atlmain.\+c@{atlmain.\+c}}
\subsubsection{\texorpdfstring{F\+A\+L\+SE}{FALSE}}
{\footnotesize\ttfamily \#define F\+A\+L\+SE~0}



Definition at line 38 of file atlmain.\+c.

\mbox{\Hypertarget{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}\label{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}} 
\index{atlmain.\+c@{atlmain.\+c}!PR@{PR}}
\index{PR@{PR}!atlmain.\+c@{atlmain.\+c}}
\subsubsection{\texorpdfstring{PR}{PR}}
{\footnotesize\ttfamily \#define PR(\begin{DoxyParamCaption}\item[{}]{x }\end{DoxyParamCaption})~(void) fprintf(stderr, x)}

\mbox{\Hypertarget{atlmain_8c_aa8cecfc5c5c054d2875c03e77b7be15d}\label{atlmain_8c_aa8cecfc5c5c054d2875c03e77b7be15d}} 
\index{atlmain.\+c@{atlmain.\+c}!T\+R\+UE@{T\+R\+UE}}
\index{T\+R\+UE@{T\+R\+UE}!atlmain.\+c@{atlmain.\+c}}
\subsubsection{\texorpdfstring{T\+R\+UE}{TRUE}}
{\footnotesize\ttfamily \#define T\+R\+UE~1}



Definition at line 39 of file atlmain.\+c.

\mbox{\Hypertarget{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}\label{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}} 
\index{atlmain.\+c@{atlmain.\+c}!V@{V}}
\index{V@{V}!atlmain.\+c@{atlmain.\+c}}
\subsubsection{\texorpdfstring{V}{V}}
{\footnotesize\ttfamily \#define V~(void)}



Definition at line 41 of file atlmain.\+c.



\subsection{Function Documentation}
\mbox{\Hypertarget{atlmain_8c_a0ddf1224851353fc92bfbff6f499fa97}\label{atlmain_8c_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{atlmain.\+c@{atlmain.\+c}!main@{main}}
\index{main@{main}!atlmain.\+c@{atlmain.\+c}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}



Definition at line 144 of file atlmain.\+c.


\begin{DoxyCode}
144                                  \{
145     \textcolor{keywordtype}{int} i;
146     \textcolor{keywordtype}{int} fname = \hyperlink{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, defmode = \hyperlink{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
147     FILE *ifp;
148     \textcolor{keywordtype}{char} *include[20];
149     \textcolor{keywordtype}{int} in = 0;
150 
151     \textcolor{keywordtype}{int} *tst;
152 
153 \textcolor{preprocessor}{#define PR(x) (void) fprintf(stderr, x)}
154 
155 \textcolor{preprocessor}{#ifdef BANNER}
156     \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"ATLAST 1.2 (2007-10-07) This program is in the public domain.\(\backslash\)n"});
157     printf(\textcolor{stringliteral}{"Compiled: %s %s\(\backslash\)n"},\_\_DATE\_\_,\_\_TIME\_\_);
158 \textcolor{preprocessor}{#endif}
159 
160     ifp = stdin;
161 
162     \textcolor{keywordtype}{int} opt;
163 
164     \textcolor{keywordflow}{while}((opt = getopt(argc,argv, \textcolor{stringliteral}{"C:DH:I:R:S:T?U"})) != -1) \{
165         \textcolor{keywordflow}{switch}(opt) \{
166             \textcolor{keywordflow}{case} \textcolor{charliteral}{'C'}:
167                 chdir(optarg);
168                 \textcolor{keywordflow}{break};
169             \textcolor{keywordflow}{case} \textcolor{charliteral}{'D'}:
170                 defmode = \hyperlink{atlmain_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
171                 \textcolor{keywordflow}{break};
172             \textcolor{keywordflow}{case} \textcolor{charliteral}{'H'}:
173                 \hyperlink{atlast_8c_ad9d3ef4d8938c4daa6a2e03a69f7ccbb}{atl\_heaplen} = atol(optarg);
174                 \textcolor{keywordflow}{break};
175             \textcolor{keywordflow}{case} \textcolor{charliteral}{'I'}:
176                 include[in]=(\textcolor{keywordtype}{char} *)malloc(strlen(optarg)+1);
177                 strncpy(include[in++], optarg, strlen(optarg));
178                 \textcolor{keywordflow}{break};
179             \textcolor{keywordflow}{case} \textcolor{charliteral}{'R'}:
180                 \hyperlink{atlast_8c_afd9331d1b5bbc754007c6dc8a0156b6b}{atl\_rstklen} = atol(optarg);
181                 \textcolor{keywordflow}{break};
182 
183             \textcolor{keywordflow}{case} \textcolor{charliteral}{'S'}:
184                 \hyperlink{atlast_8c_a6954eb123491716e08dfbf05ca5390e5}{atl\_stklen} = atol(optarg);
185                 \textcolor{keywordflow}{break};
186 
187             \textcolor{keywordflow}{case} \textcolor{charliteral}{'T'}:
188                 \hyperlink{atlast_8c_ae0c1edf4a5be638d243909d71cd93024}{atl\_trace} = \hyperlink{atlmain_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
189                 \textcolor{keywordflow}{break};
190             \textcolor{keywordflow}{case} \textcolor{charliteral}{'?'}:
191             \textcolor{keywordflow}{case} \textcolor{charliteral}{'U'}:
192                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"Usage:  ATLAST [options] [inputfile]\(\backslash\)n"});
193                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"        Options:\(\backslash\)n"});
194                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -C <dir>  Change to this directory\(\backslash\)n"});
195                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -D        Treat file as definitions\(\backslash\)n"});
196                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -Hn       Heap length n\(\backslash\)n"});
197                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -I <file> Include named definition file\(\backslash\)n"});
198                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -R n      Return stack length n\(\backslash\)n"});
199                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -S n      Stack length n\(\backslash\)n"});
200                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -T        Set TRACE mode\(\backslash\)n"});
201                 \hyperlink{atlmain_8c_aa67543462bcc869371f4cc00874b4ff1}{PR}(\textcolor{stringliteral}{"           -U        Print this message\(\backslash\)n"});
202                 \textcolor{keywordflow}{return} 0;
203         \}
204     \}
205     \textcolor{comment}{// OK, so init the system}
206     \textcolor{comment}{//}
207     \hyperlink{atlast_8c_a58f9de18b337d19aebc0e01ea7b9a897}{atl\_init}();
208 \textcolor{preprocessor}{#ifdef LINUX}
209 \textcolor{preprocessor}{#ifdef EXTRAS}
210     \textcolor{keyword}{extern} \textcolor{keywordtype}{void} \hyperlink{linux_8c_a490c36468eb63842b369cd984a7cb7ac}{extrasLoad}();
211     \hyperlink{linux_8c_a490c36468eb63842b369cd984a7cb7ac}{extrasLoad}();
212 \textcolor{preprocessor}{#endif}
213 \textcolor{preprocessor}{#endif}
214 
215 \textcolor{preprocessor}{#ifdef MQTT}
216     \textcolor{keyword}{extern} \textcolor{keywordtype}{void} \hyperlink{mqtt_8c_a218421f46fb67e1d31b75d64628d2de1}{mqttLoad}();
217     \hyperlink{mqtt_8c_a218421f46fb67e1d31b75d64628d2de1}{mqttLoad}();
218 \textcolor{preprocessor}{#endif}
219 
220     int8\_t len=0;
221     uint8\_t lineBuffer[\hyperlink{atldef_8h_a842ed03f27719bc87666bfd1f75415b8}{MAX\_LINE}];
222     \textcolor{keywordtype}{char} t[132];
223 \textcolor{preprocessor}{#ifdef PUBSUB}
224     table = newSmall();
225 \textcolor{preprocessor}{#ifdef PTHREAD}
226 \textcolor{preprocessor}{#warning Pthreads}
227     \textcolor{keywordflow}{if} (pthread\_mutex\_init(&lock, NULL) != 0) \{
228         perror(\textcolor{stringliteral}{"pthread\_mutex\_init"});
229         exit(1);
230     \}
231 
232 
233 \textcolor{preprocessor}{#endif}
234 \textcolor{preprocessor}{#ifdef LINUX}
235     sprintf(t,\textcolor{stringliteral}{"0x%x constant TABLE"},table);
236     sprintf(t,\textcolor{stringliteral}{"0x%"} PRIx64 \textcolor{stringliteral}{" constant TABLE"},table);
237 
238     \hyperlink{atlast_8c_a45d749d6527e7183b11e7c928bf763e5}{atl\_eval}(t);
239     memset(t,0x00,\textcolor{keyword}{sizeof}(t));
240 \textcolor{preprocessor}{#endif}
241     pthread\_mutex\_lock(&lock);
242     \textcolor{keywordtype}{int} err = pthread\_create(&(tid[0]), NULL, &doSmall, (\textcolor{keywordtype}{void} *)table);
243 
244 
245 \textcolor{preprocessor}{#endif}
246 
247 
248     \textcolor{comment}{/* If any include files were named, load each in turn before}
249 \textcolor{comment}{       we execute the program. */}
250 
251     \textcolor{keywordflow}{for} (i = 0; i < in; i++) \{
252         \textcolor{keywordtype}{int} stat;
253         \textcolor{keywordtype}{char} fn[132];
254         FILE *fp;
255 
256         \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} strcpy(fn, include[i]);
257         \textcolor{keywordflow}{if} (strchr(fn, \textcolor{charliteral}{'.'}) == NULL)
258             \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} strcat(fn, \textcolor{stringliteral}{".atl"});
259         fp = fopen(fn,
260 #ifdef FBmode
261                 \textcolor{stringliteral}{"rb"}
262 #\textcolor{keywordflow}{else}
263                 \textcolor{stringliteral}{"r"}
264 #endif
265                 );
266         \textcolor{keywordflow}{if} (fp == NULL) \{
267             \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} fprintf(stderr, \textcolor{stringliteral}{"Unable to open include file %s\(\backslash\)n"},
268                     include[i]);
269             \textcolor{keywordflow}{return} 1;
270         \}
271         stat = \hyperlink{atlast_8c_a0cc24398ed9212cff1741d83addaf73b}{atl\_load}(fp);
272         \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} fclose(fp);
273         \textcolor{keywordflow}{if} (stat != \hyperlink{atlast_8h_a514887c2d44f650bf5836e99dc5409b5}{ATL\_SNORM}) \{
274             \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} printf(\textcolor{stringliteral}{"\(\backslash\)nError %d in include file %s\(\backslash\)n"}, stat, include[i]);
275         \}
276     \}
277 
278     \textcolor{comment}{/* Now that all the preliminaries are out of the way, fall into}
279 \textcolor{comment}{       the main ATLAST execution loop. */}
280     \textcolor{keywordflow}{while} (\textcolor{keyword}{true}) \{
281 
282         \textcolor{keywordflow}{if} (!fname)
283             \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} printf(\hyperlink{atlast_8c_ad33b0bf102655a19a58b2271a0608e3f}{atl\_comment} ? \textcolor{stringliteral}{"(  "} :  \textcolor{comment}{/* Show pending comment */}
284                     \textcolor{comment}{/* Show compiling state */}
285                     (((\hyperlink{atlast_8c_a631c4c438b300c6392fe526a50a041c3}{heap} != NULL) && \hyperlink{atldef_8h_a17ba9d3d3f420182822febf73adca0a4}{state}) ? \textcolor{stringliteral}{":> "} : \textcolor{stringliteral}{"-> "}));
286         \textcolor{keywordflow}{if} (fgets(t, 132, ifp) == NULL) \{
287             \textcolor{keywordflow}{if} (fname && defmode) \{
288                 fname = defmode = \hyperlink{atlmain_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
289                 ifp = stdin;
290                 \textcolor{keywordflow}{continue};
291             \}
292             \textcolor{keywordflow}{break};
293         \}
294         \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} \hyperlink{atlast_8c_a45d749d6527e7183b11e7c928bf763e5}{atl\_eval}(t);
295     \}
296     \textcolor{keywordflow}{if} (!fname)
297         \hyperlink{atlmain_8c_af40a326b23c68a27cebe60f16634a2cb}{V} printf(\textcolor{stringliteral}{"\(\backslash\)n"});
298     \textcolor{keywordflow}{return} 0;
299 \}
\end{DoxyCode}
Here is the call graph for this function\+:
% FIG 1
